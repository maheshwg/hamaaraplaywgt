# Always return JSON for errors, never try to render a view
server.error.whitelabel.enabled=false
server.error.include-message=always
server.error.include-binding-errors=always
# Spring Boot Configuration
spring.application.name=test-automation-playwght-backend

# Server Configuration
server.port=8080

# Database Configuration
spring.datasource.url=jdbc:postgresql://localhost:5432/test_automation_playwght
spring.datasource.username=postgres
spring.datasource.password=postgres
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# Logging Configuration
logging.level.org.hibernate.SQL=INFO
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=INFO
logging.level.org.hibernate.orm.jdbc.bind=INFO

# File Upload
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# OpenAI Configuration (for AI step interpretation)
openai.api.key=${OPENAI_API_KEY:your-api-key-here}
openai.model=${OPENAI_MODEL:gpt-4-turbo}
openai.timeout=${OPENAI_TIMEOUT:60}

# Claude (Anthropic) Configuration
claude.api.key=${CLAUDE_API_KEY:}
claude.model=${CLAUDE_MODEL:claude-sonnet-4-5}
claude.api.url=${CLAUDE_API_URL:https://api.anthropic.com/v1/messages}
claude.api.version=${CLAUDE_API_VERSION:2023-06-01}
claude.max.tokens=${CLAUDE_MAX_TOKENS:8192}
claude.request.logging.enabled=${CLAUDE_REQUEST_LOGGING_ENABLED:false}
claude.request.logging.max.chars=${CLAUDE_REQUEST_LOGGING_MAX_CHARS:4000}

# Agent Configuration
agent.llm.provider=${AGENT_LLM_PROVIDER:openai}
agent.max.iterations=${AGENT_MAX_ITERATIONS:10}
# Path to system prompt file (relative to working directory or absolute path)
# Default to MCP-optimized prompt to reduce tokens (older agent-system-prompt.txt is legacy/non-MCP).
agent.system.prompt.file=${AGENT_SYSTEM_PROMPT_FILE:agent-system-prompt-mcp.txt}
# Path to prompt categories JSON file (use agent-prompt-categories-mcp.json for official MCP server)
agent.prompt.categories.file=${AGENT_PROMPT_CATEGORIES_FILE:agent-prompt-categories-mcp.json}
# Enable dynamic prompt building (reduces tokens by including only relevant categories)
agent.prompt.dynamic=${AGENT_PROMPT_DYNAMIC:false}
# Max characters for accessibility tree content sent to LLM
# REDUCED from 50000 to 8000 to prevent rate limiting (8000 chars ~= 2000 tokens)
agent.tool.snapshot.max.chars=${AGENT_TOOL_SNAPSHOT_MAX_CHARS:8000}
# Escalated snapshot size used only when the agent is stuck (NEED_SNAPSHOT with no progress).
# Default 30000 covers many full-page snapshots without needing repeated retries.
agent.tool.snapshot.max.chars.escalated=${AGENT_TOOL_SNAPSHOT_MAX_CHARS_ESCALATED:30000}
# Max characters for non-snapshot tool results sent to the LLM
agent.tool.response.max.chars=${AGENT_TOOL_RESPONSE_MAX_CHARS:2000}
# Conversation history truncation: keep history for N previous tool call iterations
# 0 = no history (only current), 1 = keep last iteration, 2 = keep last 2 iterations, etc.
agent.conversation.history.keep=${AGENT_CONVERSATION_HISTORY_KEEP:2}

#to log what agent is sending to mcp server
agent.trace.logging.enabled=${AGENT_TRACE_LOGGING_ENABLED:true}
agent.trace.logging.max.chars=${AGENT_TRACE_LOGGING_MAX_CHARS:2000}

# to see messages sent to Claude
CLAUDE_REQUEST_LOGGING_ENABLED=true
CLAUDE_REQUEST_LOGGING_MAX_CHARS=6000
# What youâ€™ll see in logs
# A line like:
# Claude: [info sent to Claude] systemChars=..., messagesChars=..., totalChars~=..., transcriptChars=..., transcript: ...

# MCP (Model Context Protocol) Configuration
# Set to true to use official Microsoft Playwright MCP server
mcp.playwright.enabled=${MCP_PLAYWRIGHT_ENABLED:true}
# STDIO mode: Each test execution spawns its own MCP process (no session timeout issues!)

# Screenshot Storage Configuration
# Type: "local" for local file system (default), "s3" for AWS S3
screenshot.storage.type=${SCREENSHOT_STORAGE_TYPE:local}

# Local Screenshot Storage (used when screenshot.storage.type=local)
screenshot.storage.local.directory=${SCREENSHOT_LOCAL_DIR:./screenshots}

# AWS S3 Configuration (for screenshot storage when screenshot.storage.type=s3)
aws.s3.bucket-name=${AWS_S3_BUCKET:test-automation-screenshots}
aws.s3.region=${AWS_REGION:us-east-1}
aws.access.key=${AWS_ACCESS_KEY:}
aws.secret.key=${AWS_SECRET_KEY:}
# Optional: CloudFront distribution URL for faster screenshot delivery
aws.s3.cloudfront.url=${AWS_CLOUDFRONT_URL:}

# Browser Automation Configuration
browser.headless=true
browser.timeout=30000
browser.max-sessions=5

# Thread Pool Configuration
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=10
spring.task.execution.pool.queue-capacity=100

# Logging
logging.level.com.youraitester=INFO

# Log file configuration
logging.file.name=logs/application.log
logging.file.max-size=10MB
logging.file.max-history=7
logging.file.total-size-cap=100MB

# Log pattern for file
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Log pattern for console (optional, keeping it cleaner)
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Email Configuration
# Choose ONE method: Microsoft Graph API (recommended for Microsoft 365) or SMTP

# Microsoft Graph API Configuration (for Microsoft 365/Outlook Business)
microsoft.graph.enabled=${MICROSOFT_GRAPH_ENABLED:false}
microsoft.tenant.id=${MICROSOFT_TENANT_ID:}
microsoft.client.id=${MICROSOFT_CLIENT_ID:}
microsoft.client.secret=${MICROSOFT_CLIENT_SECRET:}

# SMTP Configuration (fallback for Gmail, SendGrid, etc.)
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.from=${MAIL_FROM:support@youraitester.com}

# Trial signup configuration
trial.support.email=${TRIAL_SUPPORT_EMAIL:support@youraitester.com}
